<!DOCTYPE html>
<html>
<head lang="zh">
<meta charset="UTF-8">
<title>车车往前冲</title>
<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<meta content="email=no" name="format-detection">
<style>
    *{
        margin:0px;
        padding: 0px;
    }
    #myCanvas{
        width:100%;
        height:100%;
        position: fixed;
        top: 0px;
        left: 0px;
        right: 0px;
        bottom: 0px;
        z-index: 0;
        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnYAAAOECAMAAAAbp4xtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAxQTFRFqampM/YqM6M8MzMzKLwTcgAACzlJREFUeNrs3DEOwyAUREES3//OqV0shb2WCJ7XI630p2Z8p32mzd8eizROHUu25sbnbAzsbMQOO+ywww477LDDDjvssMMOO+ywww47J8UOOxuxww477LDDDjvssMMOO+ywww477LDDzkmxww477LDDDjsbscMOO+ywww477LDDDjvssHNS7LDDDjvsXsbuzuP5Wyf9943P2cDORuywww477LDDDjvssMMOO+ywww477LBzUuywsxE77LDDzkbssMMOO+ywww477LDDDjvsnBQ77LDDDjvssLMRO+ywww477LDDDjvssMMOOyfFDjvssMPubex8NGZjyv922GGHHXbYYYcddthhhx12Tooddthhhx122NmIHXbYYYcddthhhx122GGHnZNihx122GGHHXY2Yocddthhhx122GGHHXbYYeek2GGHHXbYYYedjdhhhx122LXY+WjMxpT/7bDDDjvssMMOO+ywww477JwUO+ywww477LCzETvssMMOO+ywww477LDDDjsnxQ477LDDDjvsbMQOO+ywww477LDDDjvssMPOSbHDDjvssMMOOxuxww477LBrsfPRmI0p/9thhx122GGHHXbYYYcddtg5KXbYYYcddthhZyN22GGHHXbYYYcddthhhx12Tooddthhhx122NmIHXbYYYcddthhhx122GGHnZNihx122GGHHXY2Yocddthh12LnozEbU/63ww477LDDDjvssMMOO+ywc1LssMMOO+yww85G7LDDDjvssMMOO+ywww477JwUO+ywww477LCzETvssMMOO+ywww477LDDDjsnxQ477LDDDjvsbMQOO+yww67FzkdjNqb8b4cddthhhx122GGHHXbYYeek2GGHHXbYYYedjdhhhx122GGHHXbYYYcddtg5KXbYYYcddthhZyN22GGHHXbYYYcddthhhx12Tooddthhhx122NmIHXbYYYddi52PxmxM+d8OO+ywww477LDDDjvssMPOSbHDDjvssMMOOxuxww477LDDDjvssMMOO+ywc1LssMMOO+yww85G7LDDDjvssMMOO+ywww477JwUO+ywww477LCzETvssMMOuxY7H43ZmPK/HXbYYYcddthhhx122GGHnZNihx122GGHHXY2Yocddthhhx122GGHHXbYYeek2GGHHXbYYYedjdhhhx122GGHHXbYYYcddtg5KXbYYYcddthhZyN22GGHHXYtdj4aszHlfzvssMMOO+ywww477LDDDjsnxQ477LDDDjvsbMQOO+ywww477LDDDjvssMPOSbHDDjvssMMOOxuxww477LDDDjvssMMOO+ywc1LssMMOO+yww85G7LDDDjvsWux8NGZjyv922GGHHXbYYYcddthhhx12Tooddthhhx122NmIHXbYYYcddthhhx122GGHnZNihx122GGHHXY2Yocddthhhx122GGHHXbYYeek2GGHHXbYYYedjdhhhx122LXY+WjMxpT/7bDDDjvssMMOO+ywww477JwUO+ywww477LCzETvssMMOO+ywww477LDDDjsnxQ477LDDDjvsbMQOO+ywww477LDDDjvssMPOSbHDDjvssMMOOxuxww477LBrsdv/ozFdzf92wg477LATdthhh52wE3bYCTthh52wE3bYYYedsMMOO+yEnbDDTtgJO+yEnbDDDjvshB122GEn7IQddsJO2GEn7IQddti12O3/0Ziu5n87YYcddtgJO+yww07YCTvshJ2ww07YCTvssMNO2GGHHXbCTthhJ+yEHXbCTthhhx12wg477LATdsIOO2En7LATdsIOO+xa7Hw0ppT/7YQddthhJ+ywww47YSfssBN2wg47YSfssMMOO2GHHXbYCTthh52wE3bYCTthhx122Ak77LDDTtgJO+yEnbDDTtgJO+ywa7Hz0ZhS/rcTdthhh52www477ISdsMNO2Ak77ISdsMMOO+yEHXbYYSfshB12wk7YYSfshB122GEn7LDDDjthJ+ywE3bCDjthJ+yww67FzkdjSvnfTthhhx12wg477LATdsIOO2En7LATdsIOO+ywE3bYYYedsBN22Ak7YYedsBN22GGHnbDDDjvshJ2ww07YCTvshJ2www67Frv9Pxobp9Y88Job/W+HHXbYYYcddthhhx122GHnpNhhhx122GGHnY3YYYcddthhhx122GGHHXbYOSl22GGHHXbYYWcjdthhhx122GGHHXbYYYcddk6KHXbYYYcddtjZiB122GGHXYvd/h+NYXc1/9thhx122GGHHXbYYYcddtg5KXbYYYcddthhZyN22GGHHXbYYYcddthhhx12Tooddthhhx122NmIHXbYYYcddthhhx122GGHnZNihx122GGHHXY2Yocddthh12LnozEbU/63ww477LDDDjvssMMOO+ywc1LssMMOO+yww85G7LDDDjvssMMOO+ywww477JwUO+ywww477LCzETvssMMOO+ywww477LDDDjsnxQ477LDDDjvsbMQOO+yww67FzkdjNqb8b4cddthhhx122GGHHXbYYeek2GGHHXbYYYedjdhhhx122GGHHXbYYYcddtg5KXbYYYcddthhZyN22GGHHXbYYYcddthhhx12Tooddthhhx122NmIHXbYYYddi52PxmxM+d8OO+ywww477LDDDjvssMPOSbHDDjvssMMOOxuxww477LDDDjvssMMOO+ywc1LssMMOO+yww85G7LDDDjvssMMOO+ywww477JwUO+ywww477LCzETvssMMOuxY7H43ZmPK/HXbYYYcddthhhx122GGHnZNihx122GGHHXY2Yocddthhhx122GGHHXbYYeek2GGHHXbYYYedjdhhhx122GGHHXbYYYcddtg5KXbYYYcddthhZyN22GGHHXYtdj4aszHlfzvssMMOO+ywww477LDDDjsnxQ477LDDDjvsbMQOO+ywww477LDDDjvssMPOSbHDDjvssMMOOxuxww477LDDDjvssMMOO+ywc1LssMMOO+yww85G7LDDDjvsWux8NGZjyv922GGHHXbYYYcddthhhx12Tooddthhhx122NmIHXbYYYcddthhhx122GGHnZNihx122GGHHXY2Yocddthhhx122GGHHXbYYeek2GGHHXbYYYedjdhhhx122LXY+WjMxpT/7bDDDjvssMMOO+ywww477JwUO+ywww477LCzETvssMMOO+ywww477LDDDjsnxQ477LDDDjvsbMQOO+ywww477LDDDjvssMPOSbHDDjvssMMOOxuxww477LBrsfPRmI0p/9thhx122GGHHXbYYYcddtg5KXbYYYcddthhZyN22GGHHXbYYYcddthhhx12Tooddthhhx122NmIHXbYYYcddthhhx122GGHnZNihx122GGHHXY2Yocddthh12LnozEbU/63ww477LDDDjvssMMOO+ywc1LssMMOO+yww85G7LDDDjvssMMOO+ywww477JwUO+ywww477LCzETvssMMOO+ywww477LDDDjsnxQ477LDDDjvsbMQOO+yww67FzkdjNqb8b4cddthhhx122GGHHXbYYeek2GGHHXbYYYedjdhhhx122GGHHXbYYYcddtg5KXbYYYcddthhZyN22GGHHXbYYYcddthhhx12Tooddthhhx122NmIHXbYYYddi52PxmxM+d8OO+ywww477LDDDjvssMPOSbHDDjvssMMOOxuxww477LDDDjvssMMOO+ywc1LssMMOO+yww85G7LDDDjvssMMOO+ywww477JwUO+ywww477LCzETvssMMOu5KNnwADAKaBSnTtoSHhAAAAAElFTkSuQmCC);
        background-size: 100% 100%;
    }
    #welcome,#gameover,#loading{
        width:100%;
        height:100%;
        position: fixed;
        top: 0px;
        bottom: 0px;
        left: 0px;
        right: 0px;
        display: none;
        z-index: 999;
    }

    #welcome{
        background: rgba(255,255,255,.3);
    }
    #gameover{
        background: rgba(255,255,255,.3);
    }
    p{
        width: 90%;
        left: 5%;
        position: fixed;
        top: 45%;
        color: #fff;
    }
    #start{
        width: 36%;
        height: 60px;
        line-height:60px;
        text-align: center;
        left: 33%;
        position: fixed;

        border: none;
        outline: none;
        bottom: 8%;
        zoom: 0;
        background: rgba(255,0,0,.9);
        color:#fff;

    }
    #msg{
        position: fixed;
        top: 31%;
        width: 100%;
        left: 0px;
        right: 0px;
        text-align: center;
        font-size: 18px;
        font-weight: 700;
        color: #000;
    }
    #restart{
        width: 40%;
        height: 40px;
        line-height:40px;
        text-align: center;
        left:0px;
        position: fixed;
        background: rgba(255,0,0,1);
        color:#fff;
        color: #fff;
        font-size: 18px;
        border: none;
        outline: none;
        bottom: 8%;
        zoom: 0;
    }
    #link{
        width: 40%;
        height: 40px;
        line-height:40px;
        text-align: center;
        right: 0px;
        position: fixed;
        background: rgba(255,0,0,1);
        color:#fff;
        font-size: 18px;
        border: none;
        outline: none;
        bottom: 8%;
        zoom: 0;
    }
    #copy{
        position: fixed;
        bottom: 0px;
        width: 100%;
        height: 30px;
        line-height: 30px;
        text-align: center;
        color: #f00;
        z-index: 999;
        background: rgba(255,255,255,0.5);
    }
</style>
<script>
function welcome(){
    document.getElementById("welcome").style.display="block";
    document.getElementById("gameover").style.display="none";
    document.getElementById("loading").style.display="none";
    //document.getElementById("myCanvas").style.display="none";
}
function gameover(){
    loop=false;
    var msg="我在高速路上行驶了"+player_time+"秒钟，你也来试试啊！";

    shareTitle=msg;

    document.getElementById("msg").innerHTML=msg;
    document.getElementById("gameover").style.display="block";
    document.getElementById("welcome").style.display="none";
    document.getElementById("loading").style.display="none";
    buttonLustTapTime=Date.parse(new Date());
}
function link(){
    if(Date.parse(new Date())-buttonLustTapTime>800) {
        window.location.href = "http://www.dobebox.com";
    }
}
function init(){
    player_w=90;
    player_h=150;
    //canvas
    canvas_w=630;
    canvas_h=960;
    canvas=document.getElementById("myCanvas");
    canvas.width=canvas_w;
    canvas.height=canvas_h;
    canvas.top = 0;
    canvas.left = 0;
    c = canvas.getContext('2d');
    res_count=0;
    resloaded=false;
    fps=1000/16;
    loop=false;
    loadingRES();
    backTime=0;
    setInterval(looping,fps);
    buttonLustTapTime=0;
    initbuttons();

    canvas.addEventListener('touchstart', function (e) {
        if (loop) {
            var touchobj = e.changedTouches[0] // reference first touch point (ie: first finger)
            startx = parseInt(touchobj.clientX) // get x position of touch point relative to left edge of browser
            player_to = "left";
            player_target_X = player_x-30;
            if(player_target_X<120){
                player_target_X=120;
            }
            e.preventDefault();
        }
    }, false);

    canvas.addEventListener('click', function (e) {
        if (loop) {
            player_to = "left";
            player_target_X = player_x-30;
            if(player_target_X<120){
                player_target_X=120;
            }
            e.preventDefault();
        }
    }, false);

    canvas.addEventListener('touchmove', function (e) {
        var touchobj = e.changedTouches[0] // reference first touch point for this event
        var distX = parseInt(touchobj.clientX) - startx;
        e.preventDefault()
    }, false);

    canvas.addEventListener('touchend', function (e) {
        var touchobj = e.changedTouches[0] // reference first touch point for this event
        //statusdiv.innerHTML = 'Status: touchend<br /> Resting x coordinate: ' + touchobj.clientX + 'px'
        e.preventDefault()
    }, false);
    //
    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
        var icon="res/icon.png";
        var url=document.location.href;
        var urlArr=url.split("/");
        var imgUrl="";
        for(i=0; i<urlArr.length-1;i++){
            imgUrl+=urlArr[i]+"/";
        }
        imgUrl+=icon;
        shareLink=document.location.href;
        shareTitle=document.title;
        shareIcon="http://mmbiz.qpic.cn/mmbiz/ZBB7rRgWr0sQORlvCzyEqq72ibnm2ep0NbZs6hPLrh7arpjTia8aCwuRlz8brhuQUl7YEIxZeUTJlib2yicP6lXNbA/640";
        // 发送给好友
        WeixinJSBridge.on('menu:share:appmessage', function (argv) {
            WeixinJSBridge.invoke('sendAppMessage', {
                "img_url":shareIcon,
                "img_width": "100",
                "img_height": "100",
                "link": shareLink,
                "desc": "",
                "title": shareTitle
            }, function (res) {
                _report('send_msg', res.err_msg);
            })
        });
        // 分享到朋友圈
        WeixinJSBridge.on('menu:share:timeline', function (argv) {
            WeixinJSBridge.invoke('shareTimeline', {
                "img_url":shareIcon,
                "img_width": "100",
                "img_height": "100",
                "link": shareLink,
                "desc": "",
                "title": shareTitle
            }, function (res) {
                _report('timeline', res.err_msg);
            });
        });
    });
}
function loadedOne(){
    res_count++;
}
function loadingRES(){
    document.getElementById("loading").style.display="block";
    document.getElementById("welcome").style.display="none";
    //document.getElementById("myCanvas").style.display="none";
    document.getElementById("gameover").style.display="none";

    car_img=new Image();
    player_img=new Image();




    car_img.onload=loadedOne;

    player_img.onload=function(){
        res_count++;
        c.clearRect(0, 0,canvas_w,canvas_h);
        c.drawImage(this,0,0,player_w,player_h);
        player_data = c.getImageData(0,0,player_w,player_h).data;
        c.clearRect(0, 0,canvas_w,canvas_h);
    }

    player_img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAACWCAMAAABpXG//AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABhQTFRFwVlZsSwsrycnbBwc23Fx/wAAzDMz////NEyzfwAAAAh0Uk5T/////////wDeg71ZAAABLUlEQVR42uzb0Y7CIBCF4Zkp0vd/4xUmEdZUTWCw281/rrzxs0mxGU6o7PekfAtNLugulb5BP+hUEkw7KiXht9FZK9lKLI9Gt6dUVHQVrdDQ0N+ns5asoWugoaEDaFtH57AYNDQ0NPSFaG103Z7KFhCXDPocWiSKLtLziKOTl15LED2cnqC/SNfCSIfjXz+ku98eypv5GhoaGhr6z9OSQiPQ59AtE2BLozV68Sn/RmhoaOhL0rO7XWH7fzJtrVmYuI2PZsHo+f4bXReHr5XJNKkfJ21JNR5NGzQ0NDT0Otqz5JgP9CXoTwccx+mPxzKhD3u+EFqPxkkde3K8HCfNi8uIx9OL+Rq60LaK9o+prR4dLy3s94Ym+Zsn3cLcR9P1IdK91NJdNfQy+keAAQAXa+B8DrdOfgAAAABJRU5ErkJggg==";
    car_img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAACWCAMAAABpXG//AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABhQTFRFZn8kjbEsuv8Aiq8nVmwcvttxo8wz////bs7DEQAAAAh0Uk5T/////////wDeg71ZAAABb0lEQVR42uzb4a7CIAwF4HI7uvd/47uW3TuCTE0pmuk5P4wz8cvChkJhtG7JP8FRdCXQf8mFzppo2lJo0QxY0qTQrFk0JN6kpYmhlLaXRHYcRu8oaNCgX05L0syhLQQa9HfRNEif9EbN8FlrWnoUbVsFNGjQoEFfkNYpZFpoOEuyGS4fdC50QIzO82i5PF1dRr/avYz76MnO3U+XSkV/YBZBM+hnaLLpn7+T67elfxnLHZTduTMlHaUJNGjQoEFPpjkHh6fRAvq8rds1Jt+5HmEMFkCDBg0adGe2K/6aBSoLb6dtoWr7ux+4jIvo97kUGVBC/AC6bmvbc8AUkJ06br7BfU83C7zRy8bdqjto0KBBfytN8+h9NBG9F+f4dMoOItBx9KMNjn764bZM0GG98Q5dxoD2zvcbxf9JzXCSbyqX7pzUr8NouS7N9shCmtHWUuoBx1xjoEpeLXuXY3vypOoyqzcVkqqHWkC/gv4VYACBBPDij/hcYwAAAABJRU5ErkJggg==";
}
function checking(){

}
function restart(){
    if(Date.parse(new Date())-buttonLustTapTime>800) {
        tangetX = 0;
        tangetT = 0;
        player_x = 120;
        player_y = canvas_h - player_h - 60;
        win = false;
        player_target_X=0;
        player_setp = 30;
        car_speed=10;
        player_time = 0;
        fps = 1000 / 32;
        loopTime = 0;
        player_to = "right";
        makeCarTime = 0;
        backgroundY = 0;
        //
        //document.getElementById("myCanvas").style.display="block";
        document.getElementById("welcome").style.display = "none";
        document.getElementById("loading").style.display = "none";
        document.getElementById("gameover").style.display = "none";
        //
        time = 0;
        cars = new Array();
        carNext = 0;
        loop = true;
    }
}

function looping(){

    if(loop){
        //
        backgroundY+=10;

        document.getElementById("myCanvas").style.backgroundPositionY=backgroundY+"px";

        loopTime+=fps;
        c.clearRect(0, 0,canvas_w,canvas_h);
        for(i in cars){

            c.drawImage(car_img,cars[i][0],cars[i][1], player_w, player_h);

        }
        player();
        var data = c.getImageData(player_x,player_y,player_w,player_h).data;
        var step=0;
        for (var ii = 3; ii < data.length; ii += 4) {
            if(loop){
                step++;
                if(step==1){
                    if (data[ii]>0 && player_data[ii] > 0) {
                        ii=data.length;
                        gameover();
                        if(data[ii-3]==255 && data[ii-2]==153 && data[ii-1]==0){

                        }
                        else if(data[ii-3]==255 && data[ii-2]==0 && data[ii-1]==0){
                            ii=data.length;
                            gameover();
                        }
                        else if(data[ii-3]==0 && data[ii-2]==153 && data[ii-1]==255){
                            win=true;
                            ii=data.length;
                            gameover();
                        }

                        break;
                    }
                    step=0;
                }
            }
        }


        //
        c.clearRect(0, 0,canvas_w,canvas_h);
        //c.drawImage(bg_img,0,0,canvas_w,canvas_h);
        makeCarTime+=fps;

        if(makeCarTime>=1000){
            //cars.push([canvas_w-player_w-60],-1*player_h]);
            makeCarTime=0;
        }
        var top=canvas_h;
        for(i in cars){
            if(cars[i][1]<top){
                top=cars[i][1];
            }
        }
        var tmp_y=Math.floor(Math.random() * 80)+player_h*1.5;
        if(top>tmp_y){
            var r=Math.floor(Math.random() * 3)+1;

            if(r==1){
                cars.push([120,-1*tmp_y]);
            }
            if(r==2){
                cars.push([270,-1*tmp_y]);
            }
            if(r==3){
                cars.push([canvas_w-player_w-120,-1*tmp_y]);
            }
        }
        for(i in cars){
            cars[i][1]+=car_speed;
            c.drawImage(car_img,cars[i][0],cars[i][1], player_w, player_h);
            if(cars[i][1]>canvas_h+player_h+100){
                cars.splice(i,1);
            }
        }


        c.drawImage(player_img, player_x, player_y, player_w, player_h);
        time+=fps;

        if(time==1000){
            time=0;
            player_time++;
        }
        c.font="50px Georgia";
        c.fillStyle="#f00";
        c.fillText(player_time,canvas_w/2-15,60);

        //

        //
    }
    //checking res loaded?
    if(resloaded==false){
        if(res_count==2){
            welcome();
            resloaded=true;
        }
    }
}
function player(){
    player_setp=10;
    if(player_to=="right"){
        player_x+=player_setp;
        if(player_x>=canvas_w-player_w-120){
            //player_to="left";
            player_x=canvas_w-player_w-120;
        }
    }
    if(player_to=="left"){
        player_x-=player_setp;
        if(player_x<=player_target_X){
            //player_to="right";
            player_x=player_target_X;
            player_to="right";
        }
        if(player_x<=120){
            //player_to="right";
            player_x=120;
            player_to="right";
        }
    }

}
window.addEventListener('load',init,false);
function initbuttons(){
    document.querySelector("#start").addEventListener('touchstart',restart);
    document.querySelector("#start").addEventListener('click',restart);
    document.querySelector("#restart").addEventListener('touchstart',restart);
    document.querySelector("#restart").addEventListener('click',restart);
    document.querySelector("#link").addEventListener('touchstart',link);
    document.querySelector("#link").addEventListener('click',link);
}
</script>
</head>
<body>
<div id="loading">loading</div>
<div id="welcome">
    <div id="start" ontouchstart="restart();">猛戳此处开始</div>
</div>
<div id="gameover">
    <p id="msg"></p>
    <div id="restart" ontouchstart="restart();">再玩一局！</div>
    <div id="link" ontouchstart="link();">更多游戏</div>
</div>
<canvas id="myCanvas"></canvas>
<div id="copy">逗比盒子</div>
<span id="tongji" style="display: none;"><script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fc961dabb84f92a11e4c69829d2968259' type='text/javascript'%3E%3C/script%3E"));
</script><script src=" http://hm.baidu.com/h.js?c961dabb84f92a11e4c69829d2968259" type="text/javascript"></script><a href="http://tongji.baidu.com/hm-web/welcome/ico?s=c961dabb84f92a11e4c69829d2968259" target="_blank"><img border="0" src="http://eiv.baidu.com/hmt/icon/21.gif" width="20" height="20"></a></span>
</body>
</html>
